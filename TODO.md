# PyWiki — Feature Backlog

Items are grouped by theme and loosely prioritised within each group.
Update status with: `[ ]` pending · `[~]` in progress · `[x]` done

---

## Markup & Rendering

- [ ] **Wikitext → Markdown/RST conversion tool** — one-shot converter to migrate
      existing wikitext pages to Markdown or RST; expose as an admin API endpoint
      and a UI button on the edit page.
- [x] **Wikitext: tables** — `{| ... |}` MediaWiki table syntax rendered to `<table>`.
- [ ] **Wikitext: `<ref>` / `<references />`** — inline footnote/citation support.
- [x] **Wikitext: `<code>` and `<pre>` blocks** — verbatim / syntax-highlighted blocks.
- [x] **Syntax highlighting** — Pygments server-side; fenced blocks in Markdown, `<syntaxhighlight>` / fenced / `<pre>` / space-indent in wikitext, code-block in RST. CSS served as `/static/css/pygments.css`.
- [ ] **Math rendering** — LaTeX via MathJax or KaTeX for `$...$` / `$$...$$`
      (Markdown) and `:math:` role (RST).
- [x] **Wikitext: image embedding** — `[[File:name.png|thumb|Caption]]` syntax; alignment modifiers; `<figure>` with caption or inline `<img>`; missing-file placeholder.
- [ ] **Live preview debounce** — reduce preview API calls; currently fires on every
      keystroke.

---

## Page Management

- [ ] **Wikitext-to-Markdown migration** — admin batch job to convert all wikitext
      pages in a namespace to Markdown.
- [x] **Page move / redirect** — when a page is renamed, leave a redirect stub at
      the old slug so existing links continue to resolve.
- [ ] **Page locking** — allow admins to mark a page as read-only.
- [ ] **Page protection levels** — per-page edit permission: any user / logged-in /
      admin only.
- [ ] **Soft delete / undelete** — mark pages as deleted rather than hard-removing
      them; admin UI to restore.
- [x] **Namespace default format** — honour `Namespace.default_format` when pre-
      filling the format selector on the Create Page form.
- [~] **Bulk import** — MediaWiki XML import done (`scripts/import_mediawiki.py`); ZIP of flat files not yet implemented.

---

## Search

- [x] **Category pages** — `[[Category:Name]]` tags on any page (all three formats)
      create a auto-generated `/category/{name}` page listing all tagged pages
      alphabetically, with namespace and last-edited date. Category links appear
      in a footer bar on every page that declares them.
- [x] **Full-text search index** — PostgreSQL `tsvector`/`plainto_tsquery` with GIN index migration; ILIKE fallback for SQLite.
- [ ] **Search by category** — `Category:Foo` query syntax.
- [ ] **Search filters** — filter results by author, date range, format.
- [ ] **Search result ranking** — score by title match > snippet match > recency.

---

## Authentication & Users

- [ ] **OAuth / SSO login** — GitHub, Google, or generic OIDC provider.
- [ ] **Email verification** — send verification link on registration.
- [ ] **Password reset** — forgot-password flow via email.
- [x] **User profile page** — display name, avatar, contribution history.
- [ ] **Per-namespace permissions** — grant read/write access per user or group.
- [ ] **API tokens** — long-lived personal access tokens for scripting/bots.

---

## Image Upload & Embedding

- [x] **Image upload UI** — drag-and-drop / file-picker on the edit page; AJAX upload; Insert button injects format-appropriate syntax at cursor.
- [x] **Inline image rendering (Markdown)** — `![alt](attachment:filename)` shorthand resolved to attachment URL at render time.
- [x] **Inline image rendering (Wikitext)** — `[[File:name.png|thumb|Caption]]` renders as `<figure><img …></figure>`; inline variant also supported.
- [ ] **Inline image rendering (RST)** — `.. image:: /api/v1/attachments/{id}` and
      `.. figure::` directives (insert syntax generated by editor; server-side resolution not yet implemented).
- [ ] **Image resizing / thumbnails** — server-side thumbnail generation on upload
      (e.g. via Pillow); serve `?width=N` variants.
- [x] **Lightbox / full-size view** — click an inline thumbnail to open the full image; close with ×, backdrop click, or Escape.

---

## Attachments

- [x] **Image gallery on page** — image thumbnails shown below page content with lightbox.
- [ ] **Attachment versioning** — keep old file versions on re-upload rather than
      overwriting.
- [ ] **S3 / object-storage backend** — configurable storage driver so attachments
      can be stored in S3-compatible stores instead of local filesystem.
- [ ] **Virus scan hook** — pluggable pre-upload scanner.

---

## UI / UX

- [ ] **Dark mode** — CSS media-query-aware theme toggle.
- [x] **Table of contents** — auto-generated from headings for all three formats; injected before first heading when ≥ 3 headings; heading anchors always added.
- [ ] **Breadcrumb navigation** — namespace → page → section.
- [ ] **Recent changes RSS/Atom feed** — `/recent.xml`.
- [ ] **Watch page** — users can watch pages and receive notifications on change.
- [ ] **Diff improvements** — side-by-side diff view in addition to unified diff.
- [ ] **Mobile-responsive editor** — improve the textarea editor on narrow screens.
- [ ] **WYSIWYG editor option** — optional rich-text editor (e.g. ProseMirror) that
      serialises back to Markdown.

---

## API & Integrations

- [ ] **OpenAPI docs polish** — add response examples and tag descriptions.
- [ ] **Webhooks** — fire a configurable HTTP POST on page create/update/delete.
- [ ] **Bot API** — rate-limited write endpoints with bot-flagged edits.
- [ ] **Export** — download a namespace as a ZIP of raw source files or HTML.

---

## Operations & Quality

- [x] **Alembic migrations** — replace `create_all` startup with proper versioned
      migrations; add initial migration for current schema.
- [x] **PostgreSQL support** — test and document running against PostgreSQL in
      production (async driver: `asyncpg`).
- [ ] **Caching layer** — Redis-backed cache for rendered HTML (invalidate on
      page update).
- [ ] **Rate limiting** — per-IP and per-user request throttling via a middleware.
- [ ] **Structured logging** — replace print/uvicorn default logging with structlog.
- [ ] **Health check endpoint improvements** — include DB connectivity and version
      info in `/api/health`.
- [ ] **Docker / docker-compose** — add `Dockerfile` and `docker-compose.yml` for
      one-command local development.
- [ ] **CI pipeline** — GitHub Actions workflow: lint → type-check → test.
- [ ] **Type annotations** — run `mypy` in strict mode; fix remaining gaps.
- [ ] **Test coverage** — target ≥ 80 % line coverage; add attachment and UI route
      tests.
