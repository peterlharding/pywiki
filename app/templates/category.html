{% extends "base.html" %}

{% block title %}Category: {{ category_name }} — {{ site_name }}{% endblock %}

{% block content %}
<div class="page-header">
  <h1>Category: {{ category_name }}</h1>
  <div class="page-actions">
    {% if user %}
      {% if cat_description_html %}
        <a class="btn btn-sm" href="/wiki/Category/{{ cat_slug }}/edit">✏️ Edit description</a>
      {% else %}
        <a class="btn btn-sm" href="/create?title={{ category_name }}&namespace=Category">➕ Add description</a>
      {% endif %}
    {% endif %}
  </div>
</div>

{% if cat_description_html %}
<div class="wiki-content category-description">
  {{ cat_description_html | safe }}
</div>
<hr style="margin: 1.5rem 0;" />
{% endif %}

{% if pages %}
<div id="mw-pages">
  <p class="search-count">The following {{ pages|length }} page{{ 's' if pages|length != 1 else '' }} {{ 'are' if pages|length != 1 else 'is' }} in this category.</p>

  {# Group pages alphabetically by first letter of title #}
  {% set alpha_groups = {} %}
  {% for p in pages | sort(attribute='title') %}
    {% set letter = p.title[0] | upper %}
    {% if letter not in alpha_groups %}
      {% set _ = alpha_groups.update({letter: []}) %}
    {% endif %}
    {% set _ = alpha_groups[letter].append(p) %}
  {% endfor %}

  <div class="category-alpha-listing">
    {% for letter, letter_pages in alpha_groups.items() | sort %}
    <div class="category-alpha-group">
      <h3>{{ letter }}</h3>
      <ul>
        {% for p in letter_pages %}
        <li>
          <a href="/wiki/{{ p.namespace }}/{{ p.slug }}">{{ p.title }}</a>
          {% if p.namespace != 'Main' %}<span class="muted"> ({{ p.namespace }})</span>{% endif %}
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endfor %}
  </div>
</div>

{% else %}
<p class="muted">No pages are currently tagged with this category.</p>
{% endif %}

{% endblock %}
