{% extends "base.html" %}

{% block title %}Recent Changes — {{ site_name }}{% endblock %}

{% block content %}
<div class="page-header">
  <h1>Recent Changes</h1>
</div>

<form class="rc-filters" method="get" action="/recent">
  <div class="rc-filter-row">
    <label for="ns-filter">Namespace:</label>
    <select id="ns-filter" name="namespace" onchange="this.form.submit()">
      <option value="">All namespaces</option>
      {% for ns in namespaces %}
      <option value="{{ ns.name }}" {% if ns.name == selected_namespace %}selected{% endif %}>
        {{ ns.name }}
      </option>
      {% endfor %}
    </select>

    <label for="limit-select">Show:</label>
    <select id="limit-select" name="limit" onchange="this.form.submit()">
      {% for n in [25, 50, 100, 200] %}
      <option value="{{ n }}" {% if n == limit %}selected{% endif %}>{{ n }}</option>
      {% endfor %}
    </select>

    {% if selected_namespace %}
    <a class="btn" href="/recent">Clear filter</a>
    {% endif %}
  </div>
</form>

{% if changes %}
<p class="search-count">{{ changes|length }} page{{ 's' if changes|length != 1 else '' }}
  {% if selected_namespace %}in <strong>{{ selected_namespace }}</strong>{% endif %}
</p>

<table class="wiki-table rc-table">
  <thead>
    <tr>
      <th>Page</th>
      <th>Namespace</th>
      <th>Ver</th>
      <th>Format</th>
      <th>Edit summary</th>
      <th>Author</th>
      <th>Last edited</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for c in changes %}
    <tr>
      <td>
        <a href="/wiki/{{ c.namespace }}/{{ c.slug }}">{{ c.title }}</a>
      </td>
      <td>
        <a href="/wiki/{{ c.namespace }}">{{ c.namespace }}</a>
      </td>
      <td class="ts">{{ c.version }}</td>
      <td>
        <span class="badge badge-{{ c.format }}">{{ c.format }}</span>
      </td>
      <td class="rc-comment">{{ c.comment or '—' }}</td>
      <td class="ts">{% if c.author and c.author != 'anonymous' %}<a href="/user/{{ c.author }}">{{ c.author }}</a>{% else %}{{ c.author }}{% endif %}</td>
      <td class="ts">{{ c.updated_at.strftime('%Y-%m-%d %H:%M') if c.updated_at else '—' }}</td>
      <td>
        <a class="btn" style="font-size:0.8rem;padding:0.15rem 0.5rem;"
           href="/wiki/{{ c.namespace }}/{{ c.slug }}/history">History</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% else %}
<p class="muted">No pages found{% if selected_namespace %} in namespace <strong>{{ selected_namespace }}</strong>{% endif %}.</p>
{% endif %}

{% endblock %}
