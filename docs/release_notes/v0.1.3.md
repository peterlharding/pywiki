# PyWiki v0.1.3 Release Notes

**Released:** 2026-02-27
**Tag:** [`v0.1.3`](https://github.com/your-org/pywiki/releases/tag/v0.1.3)
**Full changelog:** [v0.1.2 â†’ v0.1.3](https://github.com/your-org/pywiki/compare/v0.1.2...v0.1.3)

---

## What's New

### #REDIRECT Support

Redirect stubs created by page moves (or written manually) now actually redirect the browser.

**How it works:**
- Any page whose first non-blank line is `#REDIRECT [[Target Title]]` issues a **302** to the target page in the same namespace
- The target page displays a small "Redirected from old-slug" notice with a link back to the stub
- `?redirect=no` â€” append to any redirect page URL to view/edit the stub directly without following it
- Cross-namespace redirects are not followed (same namespace only)

**Example stub content** (created automatically by page move):
```
#REDIRECT [[New Page Title]]

This page has been moved to [[New Page Title]].
```

---

### Namespace Management UI

Admin users can now create, edit, and delete namespaces entirely through the UI â€” no API client needed.

**Routes:**
- `GET /special/namespaces` â€” full namespace list with page counts, visible to all users; Edit buttons for admins
- `GET /special/namespaces/create` â€” create form (admin only)
- `POST /special/namespaces/create` â€” submit new namespace
- `GET /special/namespaces/{name}/edit` â€” edit description and default format (name is immutable)
- `POST /special/namespaces/{name}/edit` â€” save changes
- `POST /special/namespaces/{name}/delete` â€” delete with JS confirmation dialog (cascades all pages in namespace)

Accessible from **Special Pages â†’ Namespaces â†’ ðŸ“‚ Manage namespaces**.

---

### User Management UI

Admin users can view and manage user accounts through the UI.

**Routes:**
- `GET /special/users` â€” user list table (admin only)
- `GET /special/users/{username}` â€” user profile (email shown to admins only)
- `GET/POST /special/users/{username}/edit` â€” edit form

**Edit permissions:**
- Admins can edit any user: display name, email, password, admin flag, active/disabled status
- Regular users can edit their own profile (display name, email, password) but cannot change admin/active flags

Accessible from **Special Pages â†’ Maintenance â†’ Users** (admin only).

---

### Create Page â€” Namespace Default Format

The format tabs (Markdown / reStructuredText / Wikitext) on the **Create Page** form now automatically switch when you change the namespace selector, reflecting that namespace's `default_format`.

The correct tab is also pre-selected on initial page load.

---

### Admin Bootstrap â€” First User Auto-Promoted

On a fresh install, the **first user to register** is automatically set as admin. No manual database intervention required.

> **Existing installs:** If your account was created before this change, promote it manually:
> ```bash
> sqlite3 pywiki.db "UPDATE users SET is_admin=1 WHERE username='your_username';"
> ```

---

## Bug Fixes

### Duplicate category bar on wikitext pages

Wikitext pages displayed two category bars â€” one from the renderer's inline footer and one from the page template. Fixed by suppressing the template's category bar when `ver.format == 'wikitext'` since the renderer owns it for that format.

### Wrong version number displayed after page rename

Page view was showing e.g. "Version 2" even when the DB had 7 versions. Root cause: `get_page()` selected the max version from an in-memory SQLAlchemy collection that was cleared by `db.refresh()` during rename. Fixed to query the DB directly with `ORDER BY version DESC LIMIT 1`.

### Edit summary pre-filled with previous comment

The edit form pre-populated the Edit summary field with the previous version's comment (e.g. `"Version 2"` or a rename comment). On save this became the new version's comment, making it look like the version number was wrong. Edit summary now always starts blank.

### "Version N" auto-comment removed

`update_page()` generated `"Version 2"`, `"Version 3"` etc. as fallback comments when none was provided. These were visible in the page info sidebar as if they were a version number. Now defaults to empty string â€” the history table already records the version number separately.

---

## CSS Additions

- `.wide-page` body class â€” expands `.page-wrapper` to full width; used by the user list page
- `.btn-sm` â€” small padding variant for action buttons inside tables
- `.btn-danger:hover` â€” hover state for delete buttons
- `.redirect-notice` â€” subtle muted styling for the "Redirected from" line on target pages

---

## Test Coverage

67 tests total, 0 failures.

**Updated tests:**
- `test_register` â€” first user now correctly asserted as `is_admin=True`
- `test_create_namespace_requires_admin` â€” seeds an admin user first so the test user is non-admin

**New redirect tests:**
- `test_redirect_page_issues_302`
- `test_redirect_page_redirected_from_notice`
- `test_redirect_bypass_with_redirect_no`
- `test_move_with_redirect_stub_auto_redirects`

---

## Upgrade Notes

No database migrations required.

```bash
git pull
git checkout v0.1.3
uv run uvicorn app.main:app --reload
```

---

## What's Next (planned for v0.1.4+)

- Wikitext table syntax (`{| ... |}`)
- Syntax highlighting for fenced code blocks
- Delete page UI confirmation form
- User profile pages showing edit history
- Search result snippet highlighting
