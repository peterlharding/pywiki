# PyWiki v0.1.2 Release Notes

**Released:** 2026-02-27
**Tag:** [`v0.1.2`](https://github.com/your-org/pywiki/releases/tag/v0.1.2)
**Full changelog:** [v0.1.1 â†’ v0.1.2](https://github.com/your-org/pywiki/compare/v0.1.1...v0.1.2)

---

## What's New

### Special:Categories Page

`/special/categories` is now a dedicated, fully-featured category index â€” matching the MediaWiki
**Special:Categories** page.

- **Alphabetical listing** with page counts â€” `Alpha (3 members)`, `Beta (1 member)`
- **Filter by prefix** â€” "Display categories starting at" input with a Show button, submits
  `?from_=X` so it is bookmarkable
- **Two-column layout** for dense category sets
- The `/special` hub now links to this page and shows a count of categories currently in use
  rather than listing them inline

---

### Page Move / Rename

Pages can now be renamed through the UI, matching MediaWiki's **Move** action.

**How to use:**

1. Open any page you have edit access to
2. Click **ðŸšš Move / Rename** in the Page tools sidebar
3. Enter the new title, an optional reason, and choose whether to leave a redirect

**Reason field**
- Free-text, optional (max 512 characters)
- Saved as a new entry in the page's version history with comment:
  `"Renamed from 'Old Title' to 'New Title': your reason"`
- Visible on the History page

**Leave a redirect checkbox** (checked by default)
- When checked, a stub page is created at the old URL containing:
  ```
  #REDIRECT [[New Title]]
  ```
- Old URLs remain accessible â€” visitors see the redirect stub and can follow the link
- When unchecked, the old URL returns 404 immediately after the move

**Same-slug renames** (e.g. `Health SHorts` â†’ `Health Shorts`) work correctly â€” the display
title updates without a URL change and no false collision error is raised.

---

## Bug Fixes

### Category tags appearing in rendered page content

`[[Category:Name]]` tags in Markdown and RST pages were passed directly to the rendering
pipeline and appeared as literal text in the output, in addition to the category footer bar.

Fixed by stripping category declarations in the pre-render preprocessors:
- Markdown: `[[Category:...]]` stripped before `mistune` renders
- RST: `[[Category:...]]` and `.. category:: ...` stripped before `docutils` renders
- Wikitext: was already handled correctly â€” no change

### Rename never persisted

`rename_page()` called `db.flush()` without `db.commit()`, so renames appeared to succeed in
the API response but were silently discarded. Fixed to `db.commit()` + `db.refresh()`.

### Same-slug rename raised false 409 conflict

Renaming a page to a title that produces the same URL slug (e.g. fixing a capitalisation typo)
incorrectly raised `409 Conflict`. The conflict check is now skipped when `new_slug == page.slug`.

### Other fixes
- Global 404 handler used deprecated Starlette `TemplateResponse` signature â€” now fixed
- `[project.scripts]` entry pointed at a FastAPI `app` object instead of a CLI function â€” removed
- `pytest.ini` deleted; pytest config consolidated into `pyproject.toml`

---

## UI Improvements

### Home page layout

The home page previously showed **Recent Changes** and **Namespaces** side-by-side in a
two-column grid, which caused overlap and a very narrow Page title column. Both sections
are now **full-width and stacked vertically**:

1. Featured page block (styled with background and border)
2. Recent Changes (full-width table â€” Page title column given 40% width)
3. Namespaces list

### Featured page block

The Main Page excerpt on the home page now has a light background, border, and padding so it
reads as a distinct framed section rather than unstyled prose.

### Page title column width

The first column of all `wiki-table` instances now has `width: 40%; min-width: 180px`,
preventing the title from being squeezed by the fixed-width Namespace / Ver / Author / Date
columns.

---

## Test Coverage

63 tests total, 0 failures, 0 warnings.

New tests added this release:
- `test_special_categories_page` â€” listing with counts
- `test_special_categories_filter` â€” `?from_=` prefix filter
- `test_move_page_form_loads` â€” move link visible when logged in
- `test_move_page_redirects_unauthenticated` â€” login redirect
- `test_move_page_renames_and_redirects` â€” successful rename â†’ 303
- `test_move_page_preserves_history` â€” history accessible at new slug
- `test_move_page_same_slug_title_fix` â€” capitalisation-only rename succeeds
- `test_move_page_reason_in_history` â€” reason text appears in history
- `test_move_page_redirect_stub_created` â€” old slug accessible after move
- `test_move_page_no_redirect_stub_when_unchecked` â€” old slug 404s without redirect
- `test_move_page_duplicate_title_shows_error` â€” 400 on true slug collision

Also added `cookie_auth()` helper to `tests/conftest.py` for authenticating UI routes via
cookie rather than `Authorization` header.

---

## Upgrade Notes

No database migrations required.

```bash
git pull
git checkout v0.1.2
uv pip install -r requirements.txt   # no new dependencies
uv run uvicorn app.main:app --reload
```

---

## What's Next (planned for v0.1.3+)

- Wikitext table syntax (`{| ... |}`)
- Syntax highlighting for fenced code blocks
- Namespace default format honoured on the Create Page form
- User profile pages

See [`TODO.md`](../../TODO.md) for the full backlog.
