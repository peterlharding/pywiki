# PyWiki v0.1.4 Release Notes

**Released:** 2026-02-27

---

## Overview

v0.1.4 focuses on user-facing identity features and test infrastructure. The headline additions are public **user profile pages** with contribution history, an **admin create-user form**, and author names linked to profiles throughout the site. The test suite was also significantly restructured and expanded from 67 to 123 tests.

---

## New Features

### User Profile Pages (`/user/{username}`)

Every user now has a public profile page at `/user/{username}`. No login is required to view it.

The profile shows:

- Display name with admin badge (and a "disabled" badge for inactive accounts)
- Member since date and total edit count
- A **Recent contributions** table listing the user's last 20 edits — page title (linked), namespace, version number, edit summary, and timestamp
- A "Showing N of M total edits" note when there are more than 20 edits
- An **Edit profile** button, visible only to the user themselves or an admin
- An **Admin view** button (links to `/special/users/{username}`), visible only to admins

### Admin Create User (`/special/users/create`)

Admins can now create user accounts directly from the UI without requiring the new user to self-register.

- Fields: username, display name (optional), email, password, admin checkbox
- Validation errors re-render the form with pre-filled values
- A **➕ Create user** button appears in the user list header for admins
- New template: `user_create.html`

### Author Names Linked to Profiles

Author names are now hyperlinks to `/user/{username}` across the entire site:

| Page | Location |
|---|---|
| Page view | Sidebar "Author" field |
| Page history | Author column |
| Recent changes | Author column |
| Home page | Recent changes Author column |
| Category pages | Author column |
| User list | Username column |

Anonymous edits remain as plain text.

---

## Bug Fixes

- **`UserUpdate` NameError** — `UserUpdate` was missing from the top-level imports in `views.py`, causing a `NameError` when submitting the user edit form. Fixed.
- **Invalid namespace name crashes** — Submitting an invalid namespace name (e.g. `"has spaces!"`) in the create form raised an unhandled Pydantic `ValidationError` (HTTP 500). Now caught and returned as HTTP 400 with the form re-rendered.

---

## New Service Functions

Two new functions added to `app/services/users.py`:

- `get_user_contributions(db, user_id, limit=20)` — returns a list of dicts with `namespace`, `slug`, `title`, `version`, `comment`, `created_at` for the user's most recent page edits
- `get_user_edit_count(db, user_id)` — returns the total number of page version rows authored by the user

---

## Test Suite Restructure

The test suite grew from **67 to 123 tests** and was reorganised from a single large `test_04_features.py` into focused files:

| File | Coverage | Tests |
|---|---|---|
| `test_04_features.py` | Categories, recent changes, special pages, printable | 23 |
| `test_05_page_move.py` | Page move / rename | 9 |
| `test_06_redirects.py` | `#REDIRECT` handling (+ 2 new edge cases) | 6 |
| `test_07_users_ui.py` | User management UI (list, view, edit, create) | 19 |
| `test_08_namespaces_ui.py` | Namespace management UI (list, create, edit, delete) | 17 |
| `test_09_user_profile.py` | User profile page, contributions, author links | 18 |

New redirect edge cases covered in `test_06`:
- Case-insensitive `#redirect` keyword detection
- Redirect not triggered when viewing a specific `?version=N`

---

## Upgrade Notes

No database schema changes. No migration required from v0.1.3.

The `/special/users/{username}` admin management view is unchanged. The new `/user/{username}` public profile is a separate, additive route.

---

## Commit Summary

```
git add -A
git commit -m "v0.1.4: user profile pages, admin create user, author links, 123 tests"
git tag -a v0.1.4 -m "Release v0.1.4"
```
