# PyWiki v0.2.0 Release Notes

**Released:** 2026-02-28

## Highlights

### PostgreSQL + Alembic
PyWiki now uses PostgreSQL as its production database via `asyncpg`. Alembic manages schema
migrations. The test suite continues to use SQLite in-memory for speed and isolation.

### MediaWiki XML Import
A new import script (`scripts/import_mediawiki.py`) lets you migrate content from an existing
MediaWiki instance into PyWiki. It handles large exports efficiently using streaming XML parsing
and maps MediaWiki namespaces to pywiki namespaces automatically.

### Category Description Pages
Categories can now have description pages, stored in the `Category` namespace — the same pattern
used by MediaWiki. The `/category/{name}` page shows the description above the page list, with
edit and create links for logged-in users.

### Improved Category Page Layout
The category page now lists pages grouped alphabetically by first letter (A, B, C …) in a
three-column layout, matching the MediaWiki `Special:Categories` style.

---

## What's New

### Added

#### MediaWiki XML Import
- `scripts/import_mediawiki.py` — standalone async import script
- Streaming `iterparse` XML parsing handles exports of any size
- Imports latest revision of each page as `wikitext`
- MW namespace filtering: ns=0 (Main articles) imported by default
- Skips Talk, User, Template, Help, File, MediaWiki, Category namespaces by default
- `--include-talk` — import Talk pages into a pywiki `Talk` namespace
- `--namespace NS` — target any pywiki namespace (default: `Main`)
- `--overwrite` — add a new version to existing pages rather than skipping
- `--dry-run` — preview what would be imported without writing anything
- `--limit N` — import only the first N pages (useful for testing)
- Auto-creates the target namespace if it doesn't exist in pywiki
- `make import-mw XML=path/to/export.xml [ARGS="..."]` Makefile target

**Quick start:**
```bash
# Preview first
make import-mw XML=~/wiki-export.xml ARGS="--dry-run --limit 20"

# Full import
make import-mw XML=~/wiki-export.xml
```

#### Category Description Pages
- Pages in the `Category` namespace describe a category at `/category/{name}`
- `Category` namespace is auto-seeded at startup — no manual setup needed
- "✏️ Edit description" / "➕ Add description" buttons on category pages (logged-in users)
- `Category` namespace hidden from the `/create` page dropdown
- After saving a category description, the user is redirected back to `/category/{title}`

#### Alphabetical Category Page Layout
- Pages grouped by first letter with H3 headings (A … Z)
- Three-column CSS layout, responsive down to single column on mobile
- Namespace shown in parentheses for non-Main pages

#### PostgreSQL + Alembic
- `DATABASE_URL` defaults to PostgreSQL + asyncpg
- `DB_POOL_SIZE` / `DB_MAX_OVERFLOW` tuning settings
- `alembic/env.py` reads URL from app settings (no duplication)
- Initial migration `b7ed900152d9` covers full schema
- New Makefile targets: `db-upgrade`, `db-downgrade`, `db-revision MSG=...`,
  `db-history`, `db-current`, `db-reset-dev`

#### SKILLS.md
- Session primer at the project root documenting environment setup, test commands,
  architecture decisions, and common workflows

### Changed
- `Categories:` label on page view and in wikitext renderer now links to `/special/categories`
- Edit page preview renders immediately on load (was blank until first keystroke)
- `make test` uses `PYTHONUNBUFFERED=1` for live per-test output through the Windows/WSL pipe

### Fixed
- `Category` namespace seed not committed at startup when `Main` already existed
- Test suite picking up `ALLOW_REGISTRATION=false` from `.env` (`conftest.py` now overrides env and clears lru_cache)

### Technical
- `RENDERER_VERSION` bumped to `5` — stale cached wikitext HTML is auto-invalidated on next page view
- `slugify()` made public in `app/services/pages.py` (was `_slugify`)

---

## Upgrading from v0.1.x

1. **Install new dependencies** (asyncpg):
   ```bash
   uv pip install -r requirements.txt --python .venv/bin/python
   ```

2. **Configure PostgreSQL** — copy `.env.example` to `.env` and set `DATABASE_URL`:
   ```
   DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/pywiki
   ```

3. **Run migrations:**
   ```bash
   make db-upgrade
   ```

4. The app will auto-create the `Category` namespace on first startup — no manual action needed.

---

## Known Limitations

- Attachment files (images etc.) from MediaWiki are **not** imported by the XML import script —
  only page text content is imported. File attachments must be uploaded separately.
- MediaWiki `Template:` pages are skipped by default. If you rely on template expansion,
  import them manually after the main import.
