# PyWiki v0.2.1 Release Notes

**Released:** 2026-02-28

## Highlights

### PostgreSQL Full-Text Search
Search results on PostgreSQL are now powered by native `tsvector` / `tsquery` FTS with
relevance ranking via `ts_rank`. Results are returned ordered by relevance rather than
alphabetical title order. A GIN index migration ensures performant queries at scale.
The test suite (SQLite) continues to use the existing `ILIKE` fallback automatically.

---

## What's New

### Added

#### Full-Text Search (`tsvector` / `plainto_tsquery`)
- `search_pages()` uses `to_tsvector('english', ...)` + `plainto_tsquery` on PostgreSQL
- Results ordered by `ts_rank` descending (most relevant first)
- `_db_dialect()` helper detects the active engine dialect — no configuration required
- `ILIKE` fallback automatically used on SQLite (test suite, local dev without PostgreSQL)
- `rank: float` field added to `SearchResult` Pydantic schema; exposed in `GET /api/v1/search`

#### GIN Index Migration (`58579c489d29`)
- `ix_page_versions_fts` — `GIN(to_tsvector('english', content))` on `page_versions`
- `ix_pages_title_fts` — `GIN(to_tsvector('english', title))` on `pages`
- Both created `CONCURRENTLY` in autocommit mode — no table lock on a live database
- Migration is a no-op on non-PostgreSQL databases

#### Search Tests (`tests/test_11_search.py`)
- 11 new tests covering both UI (`/search`) and API (`/api/v1/search`):
  - Empty search page loads
  - No-results message
  - Title match / content match
  - Non-matching result excluded
  - Snippet present in results
  - Namespace filter includes / excludes correctly
  - Result links point to correct page URL
  - `rank` field present in API response
  - Case-insensitive matching
- **Total: 155 tests** (was 144 at v0.2.0)

### Changed
- Search results ordered by **relevance rank** on PostgreSQL (was alphabetical by title)

---

## Upgrading from v0.2.0

Apply the GIN index migration:

```bash
make db-upgrade
```

This is the only required step. The migration is safe to run on a live database —
indexes are built `CONCURRENTLY` without locking the `pages` or `page_versions` tables.

No application code changes are required beyond deploying the new version.
