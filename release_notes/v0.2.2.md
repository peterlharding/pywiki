# PyWiki v0.2.2 Release Notes

**Released:** 2026-02-28

## Highlights

### Syntax Highlighting
All three content formats now support server-side syntax highlighting via
[Pygments](https://pygments.org/). Code blocks are highlighted at render time
and served as static HTML — no JavaScript required. The `friendly` Pygments
theme is included as `/static/css/pygments.css`.

---

## What's New

### Added

#### Syntax Highlighting (Pygments)

**Markdown** — fenced code blocks:
````markdown
```python
def hello():
    print("Hello, world!")
```
````
Highlighted using Pygments `HtmlFormatter`. Unknown languages fall back to plain `<pre><code>`.
Unlabelled blocks (no language tag) also fall back to plain `<pre><code>`.

**Wikitext** — four code block syntaxes are supported:

| Syntax | Highlighting |
|--------|-------------|
| `<syntaxhighlight lang="python">...</syntaxhighlight>` | ✅ Pygments |
| ` ```python\n...\n``` ` | ✅ Pygments |
| `<pre>...</pre>` | Plain `<pre>` (HTML-escaped) |
| Leading space (` code`) | Plain `<pre>` (MediaWiki convention) |

**RST** — `.. code-block::` directives:
```rst
.. code-block:: python

   def hello():
       print("hi")
```
Enabled via docutils `syntax_highlight = "short"` setting.

#### CSS
- `app/static/css/pygments.css` — generated from Pygments `friendly` theme
- Linked in `base.html` — applies to all pages automatically

#### Tests (`tests/test_12_syntax_highlight.py`)
18 new tests covering:
- Markdown: fenced Python, JS, SQL, unknown lang fallback, no-lang fallback, inline code unchanged
- Wikitext: `<syntaxhighlight>`, no-lang fallback, `<pre>`, fenced with/without lang, space-indent, surrounding text preserved
- RST: code block, inline code
- `RENDERER_VERSION == 6` assertion
- **Total: 173 tests** (was 155 at v0.2.1)

#### Dependencies
- `pygments>=2.17.0` added to `requirements.txt` and `pyproject.toml`

### Changed
- `RENDERER_VERSION` bumped to `6` — all cached rendered HTML is automatically
  invalidated and re-rendered on next page view

---

## Upgrading from v0.2.1

No database migration required.

1. Install the new dependency:
   ```bash
   /home/plh/.local/bin/uv pip install pygments>=2.17.0 --python .venv/bin/python
   ```
   Or re-install all dependencies:
   ```bash
   uv pip install -r requirements.txt --python .venv/bin/python
   ```

2. Deploy — the render cache will self-heal on first page view (no manual flush needed).

---

## Supported Languages (sample)

Pygments supports 500+ languages. Common ones for wiki use:

`python`, `javascript`, `typescript`, `sql`, `bash`, `sh`, `json`, `yaml`,
`html`, `css`, `xml`, `java`, `c`, `cpp`, `csharp`, `go`, `rust`, `ruby`,
`php`, `r`, `matlab`, `diff`, `ini`, `toml`, `dockerfile`, `nginx`

Full list: `python -c "from pygments.lexers import get_all_lexers; [print(l[1][0]) for l in get_all_lexers()]"`
